/ip firewall mangle
add action=change-mss chain=forward new-mss=1440 out-interface=all-ppp passthrough=yes protocol=tcp tcp-flags=syn tcp-mss=1441-65535
add action=change-mss chain=forward in-interface=all-ppp new-mss=1440 passthrough=yes protocol=tcp tcp-flags=syn tcp-mss=1441-65535
add action=mark-routing chain=prerouting comment=PROXY disabled=yes dst-address-list=!BYPASS in-interface=!proxy new-routing-mark=proxy passthrough=yes port=\
    80,443 protocol=tcp
add action=mark-routing chain=prerouting comment=proxy connection-mark=http/https in-interface=!proxy new-routing-mark=via_squid passthrough=no protocol=tcp \
    src-address=!172.16.0.1 src-port=80,8080,443
add action=mark-routing chain=prerouting dst-address=!172.16.0.1 in-interface=local new-routing-mark=via_squid passthrough=no port=80,443,182 protocol=tcp
add action=mark-connection chain=prerouting dst-address=!172.16.0.0/16 in-interface=proxy new-connection-mark=http/https passthrough=no port=80,443,8080 \
    protocol=tcp
add action=mark-routing chain=prerouting connection-mark=http/https in-interface=!proxy new-routing-mark=via_squid passthrough=no protocol=tcp src-address=\
    !172.16.0.1 src-port=80,8080,443
add action=mark-packet chain=prerouting comment=MARK_CACHE_HIT_FROM_PROXY_ZAIB dscp=4 new-packet-mark=proxy passthrough=no
add action=mark-connection chain=prerouting comment="closser online megaxus" dst-port=21232,41232 new-connection-mark=zar-goc passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting dst-port=32740 new-connection-mark=zar-goc passthrough=yes protocol=udp
add action=mark-connection chain=prerouting comment=mobilelegend dst-port=30091,30101,14000,39571 new-connection-mark=zar-goc passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting comment=touch dst-port=8008 new-connection-mark=zar-goc passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting comment="Counter Strike Online " dst-port=36567,8001 new-connection-mark=zar-goc passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting dst-port=8001 new-connection-mark=zar-goc passthrough=yes protocol=udp
add action=mark-connection chain=prerouting comment="Clash of God" dst-port=9430-9450,5220-5230 new-connection-mark=zar-goc passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting comment="World in Ayodance" dst-port=52510,53100-53110,54100,55100 new-connection-mark=zar-goc passthrough=yes \
    protocol=tcp
add action=mark-connection chain=prerouting comment="X-shot Indonesia" dst-port=7320-7350 new-connection-mark=zar-goc passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting dst-port=7800-7850,30000 new-connection-mark=zar-goc passthrough=yes protocol=udp
add action=mark-connection chain=prerouting comment=rf dst-port=27780 new-connection-mark=zar-goc passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting comment="cabal rs" dst-port=38111-38121,38151 new-connection-mark=zar-goc passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting comment="cabal gsp" dst-port=63112,38111 new-connection-mark=zar-goc passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting comment="Lost Saga" dst-port=14000-14010 new-connection-mark=zar-goc passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting dst-port=14000-14010 new-connection-mark=zar-goc passthrough=yes protocol=udp
add action=mark-connection chain=prerouting comment="Dragon Nest Indo" dst-port=14300-15512 new-connection-mark=zar-goc passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting dst-port=15000-15500 new-connection-mark=zar-goc passthrough=yes protocol=udp
add action=mark-connection chain=prerouting comment="Cross Fire indonesia" dst-port=10009,13008,16666,28012 new-connection-mark=zar-goc passthrough=yes \
    protocol=tcp
add action=mark-connection chain=prerouting dst-port=12020-12080,13000-13080 new-connection-mark=zar-goc passthrough=yes protocol=udp
add action=mark-connection chain=prerouting comment=lol dst-port=2099,5222,5223,8393-8400 new-connection-mark=zar-goc passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting dst-port=5000-5500 new-connection-mark=zar-goc passthrough=yes protocol=udp
add action=mark-connection chain=prerouting comment="musuh abdi" dst-port=12310-12320 new-connection-mark=zar-goc passthrough=yes protocol=udp
add action=mark-connection chain=prerouting comment=hon dst-port=9100-9200,11200-11500 new-connection-mark=zar-goc passthrough=yes protocol=udp
add action=mark-connection chain=prerouting comment=ayodance dst-port=18901-18909 new-connection-mark=zar-goc passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting comment=atalantica dst-port=4300 new-connection-mark=zar-goc passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting comment="ayo oke" dst-port=28001-28010 new-connection-mark=zar-goc passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting dst-port=26001-26010 new-connection-mark=zar-goc passthrough=yes protocol=udp
add action=mark-connection chain=prerouting comment="age of wushu" dst-port=2001,2002,2003 new-connection-mark=zar-goc passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting comment=dota2 dst-port=9100-9200,8230-8250,8110-8120 new-connection-mark=zar-goc passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting dst-port=28010-28200,27010-27200,39000 new-connection-mark=zar-goc passthrough=yes protocol=udp
add action=mark-connection chain=prerouting comment="fifa online" dst-port=7777,7778,6316,6318,6320,6322,6324,6326,6328,6330,6332,6334,7779 \
    new-connection-mark=zar-goc passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting dst-port=6317,6319,6321,6323,6325,6327,6329,6331,6333,6325,16316 new-connection-mark=zar-goc passthrough=yes \
    protocol=udp
add action=mark-connection chain=prerouting dst-port=16318,16320,16322,16324,16326,16328,16330,16332,16334 new-connection-mark=zar-goc passthrough=yes \
    protocol=udp
add action=mark-connection chain=prerouting comment=blacksquad dst-port=61000,62000 new-connection-mark=zar-goc passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting dst-port=50000-50100 new-connection-mark=zar-goc passthrough=yes protocol=udp
add action=mark-connection chain=prerouting comment=pointblank dst-port=49100,39000-39500,11007 new-connection-mark=zar-goc passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting dst-port=40000-40010 new-connection-mark=zar-goc passthrough=yes protocol=udp
add action=mark-packet chain=prerouting connection-mark=zar-goc new-packet-mark=zar-gopd passthrough=no
add action=mark-connection chain=forward comment="GAME FACEBOOK" dst-port=843,9339,8890,7200-7210,7450-7460,8000,64990-65010,4000,26590-26600 \
    new-connection-mark=zar-gfc passthrough=yes protocol=tcp
add action=mark-packet chain=forward connection-mark=zar-gfc in-interface=speedy new-packet-mark=zar-gfpd passthrough=no
add action=mark-packet chain=forward connection-mark=zar-gfc new-packet-mark=zar-gfpu out-interface=speedy passthrough=no
add action=mark-packet chain=forward comment="LIMIT EXTENTION" layer7-protocol="YOUTUBE DOWNLOAD" new-packet-mark="YOUTUBE DOWNLOAD" passthrough=no
add action=mark-packet chain=forward layer7-protocol="YOUTUBE STREAMING" new-packet-mark="YOUTUBE STREAMING" passthrough=no
add action=mark-packet chain=forward layer7-protocol=TUBE new-packet-mark=PORN1 passthrough=no
add action=mark-packet chain=forward layer7-protocol=PORN new-packet-mark=PORN2 passthrough=no
add action=mark-packet chain=forward layer7-protocol=VIDEO new-packet-mark=PORN3 passthrough=no
add action=mark-packet chain=forward layer7-protocol=MOVIE new-packet-mark=PORN4 passthrough=no
add action=mark-packet chain=forward layer7-protocol=MKV new-packet-mark=MKV passthrough=no
add action=mark-packet chain=forward layer7-protocol=MP3 new-packet-mark=MP3 passthrough=no
add action=mark-packet chain=forward layer7-protocol=MP4 new-packet-mark=MP4 passthrough=no
add action=mark-packet chain=forward layer7-protocol=ZIP new-packet-mark=ZIP passthrough=no
add action=mark-packet chain=forward layer7-protocol=EXE new-packet-mark=EXE passthrough=no
add action=mark-packet chain=forward layer7-protocol=FLV new-packet-mark=FLV passthrough=no
add action=mark-packet chain=forward layer7-protocol=ISO new-packet-mark=ISO passthrough=no
add action=mark-packet chain=forward layer7-protocol=MOV new-packet-mark=MOV passthrough=no
add action=mark-packet chain=forward layer7-protocol=MPEG new-packet-mark=MPEG passthrough=no
add action=mark-packet chain=forward layer7-protocol=MPG new-packet-mark=MPG passthrough=no
add action=mark-packet chain=forward layer7-protocol=RAR new-packet-mark=RAR passthrough=no
add action=mark-packet chain=forward layer7-protocol=WAV new-packet-mark=WAV passthrough=no
add action=mark-packet chain=forward layer7-protocol=WMV new-packet-mark=WMV passthrough=no
add action=mark-packet chain=forward layer7-protocol=VIDEO new-packet-mark=VIDEO passthrough=no
add action=mark-packet chain=forward layer7-protocol=TUBE new-packet-mark=TUBE passthrough=no
add action=mark-packet chain=forward layer7-protocol=7z new-packet-mark=7z passthrough=no
add action=mark-packet chain=forward comment="video streaming" layer7-protocol=video_stream new-packet-mark="video streaming" passthrough=no
add action=mark-packet chain=forward comment=youtube layer7-protocol=youtube new-packet-mark=youtube passthrough=no
add action=mark-packet chain=forward comment=youtube2 layer7-protocol=youtube2 new-packet-mark=youtube2 passthrough=no
add action=mark-connection chain=prerouting comment="idm limit" layer7-protocol=IDM-Limit new-connection-mark=IDM-Conn passthrough=yes
add action=mark-packet chain=prerouting connection-limit=2,32 connection-mark=IDM-Conn new-packet-mark=IDM-Conn passthrough=no
add action=mark-connection chain=prerouting comment="download idm" dst-port=8080,80,53 new-connection-mark=browsing-con passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting comment="download idm" dst-port=443 new-connection-mark=browsing-con passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting comment=HTTP new-connection-mark=browsing-con passthrough=yes
add action=mark-connection chain=prerouting comment=HTTP new-connection-mark=browsing-con passthrough=yes protocol=tcp
add action=mark-connection chain=prerouting comment=HTTP new-connection-mark=browsing-con passthrough=yes protocol=udp
add action=mark-connection chain=prerouting comment=HTTP new-connection-mark=browsing-con passthrough=yes protocol=icmp
add action=mark-connection chain=prerouting comment=HTTP new-connection-mark=browsing-con passthrough=yes protocol=igmp
add action=mark-connection chain=prerouting comment=pup new-connection-mark=browsing-con passthrough=yes src-address=118.98.109.0/24
add action=mark-connection chain=prerouting dst-address=118.98.109.0/24 new-connection-mark=browsing-con passthrough=yes
add action=mark-connection chain=prerouting comment="local ip" new-connection-mark=browsing-con passthrough=yes src-address=192.168.1.0/24
add action=mark-connection chain=prerouting dst-address=192.168.1.0/24 new-connection-mark=browsing-con passthrough=yes
add action=mark-connection chain=prerouting comment="hotspot ip" new-connection-mark=browsing-con passthrough=yes src-address=192.168.200.0/24
add action=mark-connection chain=prerouting dst-address=192.168.200.0/24 new-connection-mark=browsing-con passthrough=yes
add action=mark-packet chain=forward connection-mark=browsing-con in-interface=speedy new-packet-mark=download passthrough=no
add action=mark-packet chain=forward connection-mark=browsing-con new-packet-mark=upload out-interface=speedy passthrough=no
add action=mark-connection chain=prerouting comment="cyberindo up" dst-address=43.252.183.0/24 new-connection-mark=CYBERINDO_UP passthrough=yes
add action=mark-connection chain=prerouting dst-address=43.252.184.0/24 new-connection-mark=CYBERINDO_UP passthrough=yes
add action=mark-connection chain=prerouting dst-address=43.252.185.0/24 new-connection-mark=CYBERINDO_UP passthrough=yes
add action=mark-connection chain=prerouting dst-address=43.252.186.0/24 new-connection-mark=CYBERINDO_UP passthrough=yes
add action=mark-connection chain=prerouting dst-address=43.252.187.0/24 new-connection-mark=CYBERINDO_UP passthrough=yes
add action=mark-connection chain=prerouting dst-address=103.12.30.0/24 new-connection-mark=CYBERINDO_UP passthrough=yes
add action=mark-connection chain=prerouting dst-address=110.232.93.0/24 new-connection-mark=CYBERINDO_UP passthrough=yes
add action=mark-connection chain=prerouting dst-address=103.11.133.0/24 new-connection-mark=CYBERINDO_UP passthrough=yes
add action=mark-packet chain=forward connection-mark=CYBERINDO_UP new-packet-mark=CYBERINDO_UP passthrough=no
add action=mark-connection chain=prerouting comment="cyberindo download" new-connection-mark=CYBERINDO_DOWN passthrough=yes src-address=43.252.183.0/24
add action=mark-connection chain=prerouting new-connection-mark=CYBERINDO_DOWN passthrough=yes src-address=43.252.184.0/24
add action=mark-connection chain=prerouting new-connection-mark=CYBERINDO_DOWN passthrough=yes src-address=43.252.185.0/24
add action=mark-connection chain=prerouting new-connection-mark=CYBERINDO_DOWN passthrough=yes src-address=43.252.186.0/24
add action=mark-connection chain=prerouting new-connection-mark=CYBERINDO_DOWN passthrough=yes src-address=43.252.187.0/24
add action=mark-connection chain=prerouting new-connection-mark=CYBERINDO_DOWN passthrough=yes src-address=103.12.30.0/24
add action=mark-connection chain=prerouting new-connection-mark=CYBERINDO_DOWN passthrough=yes src-address=110.232.93.0/24
add action=mark-connection chain=prerouting new-connection-mark=CYBERINDO_DOWN passthrough=yes src-address=103.11.133.0/24
add action=mark-packet chain=forward connection-mark=CYBERINDO_DOWN new-packet-mark=CYBERINDO_DOWN passthrough=no
add action=mark-connection chain=prerouting comment="steam update" new-connection-mark="steam down" passthrough=yes protocol=tcp src-address=103.10.124.0/24
add action=mark-connection chain=prerouting new-connection-mark="steam down" passthrough=yes protocol=tcp src-address=103.28.54.0/24
add action=mark-packet chain=prerouting connection-mark="steam down" new-packet-mark="steam download" passthrough=no
add action=mark-routing chain=prerouting dst-address=!172.16.0.1 dst-port=80 in-interface=hotspot new-routing-mark=via_squid passthrough=no protocol=tcp
add action=mark-routing chain=prerouting dst-address=!172.16.0.1 in-interface=local new-routing-mark=via_squid passthrough=no port=80,443,182 protocol=tcp
add action=mark-connection chain=prerouting dst-address=!172.16.0.0/16 in-interface=proxy new-connection-mark=http/https passthrough=no port=80,443,8080 \
    protocol=tcp
